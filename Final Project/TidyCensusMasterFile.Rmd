---
title: "UScensus"
author: "Spencer Weed"
date: "2024-04-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## INFO

Point of this Rmarkdown is to record everything I know about working with the census data through tidycensus


## Accessing the census

Library is as follows:

```{r census, echo=FALSE}
library(tidycensus)

##Way to check if already downloaded, and if not, download it:
if (!require(tidycensus)) install.packages("tidycensus"); require(tidycensus)

#Also installing packages needed for examples here:
if (!require(tidyverse)) install.packages("tidyverse"); require(tidyverse)
if (!require(ggplot2)) install.packages("ggplot2"); require(ggplot2)

```
API:
The API basically allows us to access the data directly from the census and uncaps datarate stipulations that the census puts on accessing thier data
We can all use the same API if we wish.

R restart might be needed (or just rerun this line when you reopen the file)

```{r api, echo=FALSE}
census_api_key("308afb6a1b31e9fca538c651400ae9f1c3026131", install = TRUE)
```
Basics:
Simple things we can do w tidyCensus

#Two main functions:

```{r tidycensus, echo=FALSE}
#For the 2000 and 2010 and 2020(default) census datasets
#Used to fill a dataframe w data:
age20 <- get_decennial(geography = "state",  #Filter data by state
                       variables = "P13_001N", #What statistic are we looking for, this means average age (SEE BELOW)
                       year = 2020,  #year you want the data from
                       sumfile = "dhc")   #Where do we want the data to come from, this is Demographic and Housing Characteristics

age20 


#PLOTTING IT  
age20 %>%
  ggplot(aes(x = value, y = reorder(NAME, value))) + 
  geom_point()

```
```{r tidycensus, echo=FALSE}

#American Community Survey (ACS) -- 
#data are available from the 1-year ACS since 2005 for geographies of population 65,000 and greater, and from the 5-year ACS for all geographies down to the block group level starting with the 2005-2009 dataset. 
#THIS DATA IS BASED ON SAMPLING NOT POP LIKE DECENNIAL but is yearly

vt <- get_acs(geography = "county", 
              variables = c(medincome = "B19013_001"), 
              state = "VT", 
              year = 2021)

vt


#Graphing
vt %>%
  mutate(NAME = gsub(" County, Vermont", "", NAME)) %>%
  ggplot(aes(x = estimate, y = reorder(NAME, estimate))) +
  geom_errorbarh(aes(xmin = estimate - moe, xmax = estimate + moe)) +
  geom_point(color = "red", size = 3) +
  labs(title = "Household income by county in Vermont",
       subtitle = "2017-2021 American Community Survey",
       y = "",
       x = "ACS estimate (bars represent margin of error)")

```

GEOGRAPHY DATA AVAILABLE Can be found here:
https://walker-data.com/tidycensus/articles/basic-usage.html

Searching for variables
Getting variables from the Census or ACS requires knowing the variable ID - and there are thousands of these IDs across the different Census files. To rapidly search for variables, use the load_variables() function. The function takes two required arguments: the year of the Census or endyear of the ACS sample, and the dataset name, which varies in availability by year. For the decennial Census, possible dataset choices include "pl" for the redistricting files; "dhc" for the Demographic and Housing Characteristics file and "dp" for the Demographic Profile (2020 only), and "sf1" or "sf2" (2000 and 2010) and "sf3" or "sf4" (2000 only) for the various summary files. Special island area summary files are available with "as", "mp", "gu", or "vi".

For the ACS, use either "acs1" or "acs5" for the ACS detailed tables, and append /profile for the Data Profile and /subject for the Subject Tables. To browse these variables, assign the result of this function to a variable and use the View function in RStudio. An optional argument cache = TRUE will cache the dataset on your computer for future use.

https://walker-data.com/tidycensus/articles/basic-usage.html



```{r tidycensus, echo=FALSE}

v17 <- load_variables(2017, "acs5", cache = TRUE)  

#2017 data, ACS5 = the 5 year sample or ACS1 for the one year sample, cashe = save the data for easier loading.

View(v17)  ## view the variable codes for the set above, and can be used in get_decennial(geography = "state", variables = "USED HERE") 
# or in get_acs(geography = "state", variables = "USED HERE")

```







